V add_or_get<M extends Map<K, V>, K, V>(M m, K key, V Function() def) {
  if (m.containsKey(key)) return m[key];
  final val = def();
  m[key] = val;
  return val;
}